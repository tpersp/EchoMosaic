# EchoMosaic

EchoMosaic is a web-based control panel and viewer for orchestrating multi-screen art walls, signage, or live dashboards. Spin up as many streams as your hardware can handle, mix local media with web embeds, and generate fresh imagery through Stable Horde without ever leaving the browser. The application is built with Flask and uses Socket.IO for instant, real-time updates.

## Features

- **Unlimited multi-stream dashboard** - add, remove, or reorder stream cards on the fly; the only limit is the CPU, GPU, and bandwidth available on your host.
- **Flexible sources** - each stream can rotate through a folder, pin a single file, load assets generated by Stable Horde, or embed live video directly from YouTube, Twitch, HLS/DASH, or any other site that allows iframes.
- **Stable Horde integration** - craft prompts per stream, queue multiple jobs, tweak advanced controls (post-processing, LoRAs, worker filters, hires fix), search CivitAI for new LoRAs, and optionally enable auto-generate so fresh renders arrive on a schedule.
- **Per-stream controls** - adjust rotation intervals, shuffle folders, lock a single image, change image quality, toggle overlays, pause a stream, or swap the source type directly from the card.
- **Real-time coordination** - every change is pushed to all connected clients over Socket.IO, so wall displays, control tablets, and remote viewers stay in sync automatically.
- **Adaptive image delivery** - thumbnail caching plus `size`, `width`, and `height` query parameters keep bandwidth low and ensure fast updates even with dozens of simultaneous streams.

## Dashboard overview

- Stream cards surface the current source, playback mode, rotation timer, Stable Horde status, and quick actions (pause, resume, delete).
- Use the Add Stream button to create a new card, picking between folder rotation, single image, Stable Horde prompt, or embedded URL.
- Each card exposes Stable Horde tools inline: edit prompts, enable auto-generate, review the job queue, and open the full editor modal for fine-tuning.
- Global controls at the top of the dashboard let you filter streams, refresh all Stable Horde jobs, and toggle stream cards between compact and expanded layouts.

## Stream sources

- **Folder rotation**: point at a directory on the server to cycle randomly or sequentially through images; optionally limit to certain file types.
- **Single image**: lock the card to one asset when you need a static reference or hero shot.
- **Stable Horde**: build prompts per stream, enqueue jobs, and let the auto-generate timer request new renders while you focus on curation.
- **Embedded URL**: drop in a YouTube, Twitch, or other embeddable URL to show live video or web dashboards. Direct HLS or DASH manifests (`.m3u8`, `.mpd`) are supported as well.

## Image delivery and caching

The `/stream/image/<path:filename>` endpoint understands optional sizing hints so browsers do not have to fetch full-resolution assets when a thumbnail will do.

- Use `?size=thumb`, `?size=medium`, or `?size=full` for preset bounds (320 px, 1024 px, or the original resolution).
- Provide `?width=` and/or `?height=` for custom bounds; EchoMosaic preserves aspect ratio automatically.
- The first request writes the resized copy under `${IMAGE_DIR}/_thumbnails/...` and later requests reuse the cached file.
- Responses include `Cache-Control: public, max-age=31536000` plus strong `ETag` headers so standard HTTP caching works.
- Stream cards include an Image Quality drop-down so operators can switch between Auto, Thumb, Medium, or Full without editing URLs; remote `/stream/<name>` views pick up the change instantly.

If no sizing parameters are provided the service returns the original file unchanged.

## Getting started

### Quick install (Debian/Ubuntu)

The `install.sh` script installs system dependencies, creates a virtual environment, installs Python packages, and registers a systemd service. Run it with sufficient privileges (for example via `sudo`).

```
chmod +x install.sh
sudo ./install.sh
```

The script prompts for the service account, installation directory, and TCP port. After installation you can access the dashboard at `http://your-server:PORT/`.

> **Note:** If you need to keep media somewhere other than the default `/mnt/viewers`, edit the `IMAGE_DIR` constant near the top of `app.py` before running the installer.

### Development run

1. Clone the repository and create a virtual environment.
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   pip install -r requirements.txt
   ```
2. Launch the development server.
   ```bash
   python app.py
   ```
   The app listens on all interfaces on port 5000 by default. Visit `http://localhost:5000/` to open the dashboard.

## Updating

Use the `update.sh` script to fetch the latest code, update dependencies, and restart the systemd service.

```
chmod +x update.sh
./update.sh
```

By default it looks for an installation in `/opt/echomosaic` managed by the `echomosaic.service` unit. Override these values when prompted if your deployment differs.

## Manual installation

Prefer to manage everything yourself? Follow these steps:

1. Install system dependencies.
   ```bash
   sudo apt update
   sudo apt install -y python3 python3-venv python3-pip
   ```
2. Create and activate a virtual environment.
   ```bash
   python3 -m venv venv
   source venv/bin/activate
   ```
3. Install Python dependencies.
   ```bash
   pip install -r requirements.txt
   ```
4. Run the application for development or behind your own process manager.
   ```bash
   python app.py
   ```
   For production, consider wrapping the app with Gunicorn or another WSGI server and placing it behind an Nginx reverse proxy. `install.sh` shows an example systemd service definition you can adapt.

## Contributing

Contributions are welcome! Please open an issue or pull request to propose features, report bugs, or share ideas. When submitting code, follow a consistent style, include docstrings where they improve readability, and add tests when practical.

## License

This project is licensed under the MIT License. See `LICENSE` for details.

