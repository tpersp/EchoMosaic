<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EchoMosaic Streams</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='streams.css') }}">
</head>
<body>
<!-- NOTE: Do not add headers/toolbars here; keep the streams view UI-free. -->
{% set stream_items = stream_settings.items()|list %}
<div id="mosaic" class="mosaic-grid stream-count-{{ stream_items|length }}" data-stream-count="{{ stream_items|length }}">
  {% if stream_items %}
    {% for stream_id, conf in stream_items %}
    <div class="mosaic-cell">
      <iframe src="{{ url_for('render_stream', name=(conf.label if conf.label else stream_id)|slugify) }}" allow="autoplay" loading="lazy" scrolling="no"></iframe>
    </div>
    {% endfor %}
  {% else %}
    <div class="mosaic-empty">
      <p>No active streams configured.</p>
    </div>
  {% endif %}
</div>
<script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
<script>
// Apply saved theme silently (no UI elements on streams page)
(function(){
  const root = document.documentElement;
  const saved = localStorage.getItem('theme');
  root.setAttribute('data-theme', saved === 'light' ? 'light' : 'dark');
})();

const socket = io();
['streams_changed', 'mosaic_refresh'].forEach(ev => {
  socket.on(ev, () => { location.reload(); });
});
</script>
</body>
</html>
